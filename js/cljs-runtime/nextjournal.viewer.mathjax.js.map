{"version":3,"sources":["nextjournal/viewer/mathjax.cljs"],"mappings":";;AAMA;;;;;2CAAA,3CAAKA;AAOL,wCAAA,2CAAA,qDAAA,gKAAA,kDAAA,1VAAKC;AAIL,0CAAA,1CAAMC,4FAASC;AAAf,AACE,IAAAC,gBAAA,AAAAC,8BAAA;AAAA,AAAA,IAAAC,2BAAAC;AAAA,AAAA,GAAA,CAAAD,4BAAA;AAAA;AAAA,IAAAE,yBAAAF;AAAA,AAAA,GAAA,CAAA,AAAAF,6BAAA,AAAAI;AAAA,AAAA,GAAAC;AAAA,AAAA,AAAA,EAAAC,wBAAAC,4BAAAC,eAAA,CAAA,iDAAA;;AAAA;;AAAA;;AAAA,CAAA,AAAAR,2BAAA,AAAAI;;;AAAA,IAAAK,YAAA,CAAA,AAAAT,yBAAA;eAAA,EAAA,EAAAS,eAAA,AAAAC,cAAA,AAAAV,6BAAA,SAAA,CAAAA,cAAA,8DAAA,CAAAA,cAAA,9KAAaY,wGAAI,gDAAA,hDAACC;oBAAlB,EAAA,EAAAJ,eAAA,AAAAC,cAAA,AAAAV,6BAAA,SAAA,CAAAA,cAAA,8DAAA,CAAAA,cAAA,nLACac,6GAAS,gDAAA,hDAACD;IADvBF,WAAA;+BAEM,AAACI,uDAAW,CAAClB,sEAAAA,gHAAAA,5CAAWD,4FAAAA,7TACxB,IAAAoB;IAAAC,yBAAA,CAAAD,yBAAA;AAAA,AAAA,AAAAC,4BAAAD,yBAAA;AAAA,AAAe,OAACE,sBAAOJ,cAAS,AAAWK;;;AAC/C,oBAAM,iBAAAC,oBAAA,AAAAC,gBAAMT;AAAN,AAAA,oBAAAQ;AAAA,IAAAA,wBAAA,AAAAC,gBAAWP;AAAX,AAAA,oBAAAM;AAAoBrB;;AAApBqB;;;AAAAA;;;AAAN,AACE,IAAME,UAAE,iBAAAC,WAAM3B;IAAN2B,eAAA,EAAA,CAAAA,oBAAAC,oBAAA,AAAAD,aAAA;AAAA,AAAA,QAAAA;KAAA;AACO,OAAU,AAAAF,gBAAKP,uBAASf;;;KAD/B;AAEQ,OAAY,AAAAsB,gBAAKP,yBAASf;;;;AAFlC,MAAA,KAAA0B,MAAA,CAAA,mEAAAF;;;;AAAR,AAGE,IAAAG,2BAAW,AAAA,AAAAL,gBAAeT;AAA1B,AAAA,oBAAAc;AAAA,cAAAA,VAASC;AAAT,AACE,AAAA,AAAAN,gBAAgBT,uBAAIU,QAAEK;;AACtB,AAAA,AAAAN,gBAAeT,sBAAIU;;;AANzB;;AAJF,0FAAA,mDAAA,2CAAA,mDAWc,WAAKM;AAAL,AAAS,oBAAMA;AAAN,AAAS,OAACV,sBAAON,SAAIgB;;AAArB;;;;;AAXvB,AAAAjB;;AAaF,oCAAA,pCAAMkB,gFAAQ9B;AAAd,AAAA,2BAAA,yIAAA,2CAAA,6EAAA,9KACmCD,wCAAQC","names":["nextjournal.viewer.mathjax/output-format","nextjournal.viewer.mathjax/bundle-url","nextjournal.viewer.mathjax/viewer*","value","with-let60674","reagent.ratom/with-let-values","temp__5757__auto__","reagent.ratom/*ratom-context*","c__57349__auto__","reagent.debug/has-console","reagent.debug/tracking","reagent.debug/track-console","js/console","init60675","cljs.core/not","res60676","!el","reagent.core.atom","!mathjax","js/module$node_modules$d3_require$dist$d3_require.require","obj__55881__auto__","f__55882__auto__","cljs.core/reset!","js/window","and__4221__auto__","cljs.core/deref","r","G__60680","cljs.core/Keyword","js/Error","temp__5751__auto__","c","el","nextjournal.viewer.mathjax/viewer"],"sourcesContent":["(ns nextjournal.viewer.mathjax\r\n  (:require [applied-science.js-interop :as j]\r\n            [\"d3-require\" :as d3]\r\n            [nextjournal.util.cljs-extensions]\r\n            [reagent.core :as r]))\r\n\r\n(def output-format\r\n  \"the output format to use. Either `:svg` or `:html`. See\r\n  http://docs.mathjax.org/en/latest/output/index.html for a discussion of\r\n  tradeoffs. `:html` is currently not showing up.\"\r\n  :svg)\r\n\r\n;; generated from https://nextjournal.com/a/NSFQvyN7UnNdGKoc3QMC9\r\n(def bundle-url\r\n  {:html \"https://run.nextjournalusercontent.com/data/QmaH3kKYJoHuVwUx7MYmxRFdFdvEyeJcGYFWChB3UUeDT3?filename=es5/tex-chtml-full.js&content-type=application/javascript\"\r\n   :svg \"https://run.nextjournalusercontent.com/data/QmQadTUYtF4JjbwhUFzQy9BQiK52ace3KqVHreUqL7ohoZ?filename=es5/tex-svg-full.js&content-type=application/javascript\"})\r\n\r\n(defn viewer* [value]\r\n  (r/with-let [!el (r/atom nil)\r\n               !mathjax (r/atom nil)]\r\n    (-> (d3/require (bundle-url output-format))\r\n        (j/call :then #(reset! !mathjax (.-MathJax js/window))))\r\n    (when (and @!el @!mathjax value)\r\n      (let [r (case output-format\r\n                :svg (.tex2svg ^js @!mathjax value)\r\n                :html (.tex2chtml ^js @!mathjax value))]\r\n        (if-let [c (.-firstChild @!el)]\r\n          (.replaceChild @!el r c)\r\n          (.appendChild @!el r))))\r\n    [:div {:ref (fn [el] (when el (reset! !el el)))}]))\r\n\r\n(defn viewer [value]\r\n  ^{:nextjournal/viewer :reagent} [viewer* value])\r\n"]}
{"version":3,"sources":["nextjournal/viewer/code.cljs"],"mappings":"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","names":["nextjournal.viewer.code/cm6-theme","js/module$node_modules$$codemirror$view$dist$index_cjs.EditorView","nextjournal.viewer.code/highlight-style","js/module$node_modules$$codemirror$language$dist$index_cjs.HighlightStyle","cljs.core/clj->js","js/module$node_modules$$lezer$highlight$dist$index_cjs.tags","nextjournal.viewer.code/ext","nextjournal.clojure-mode/default-extensions","js/module$node_modules$$codemirror$language$dist$index_cjs.syntaxHighlighting","p1__60708#","nextjournal.viewer.code/viewer*","value","prev-view","obj60709","js/undefined","cljs.core.not_EQ_","parent__55888__auto__","f__55889__auto__","G__60710","obj__55881__auto__","f__55882__auto__","obj60711","obj60712","js/module$node_modules$$codemirror$state$dist$index_cjs.EditorState","nextjournal.viewer.code/viewer"],"sourcesContent":["(ns nextjournal.viewer.code\r\n  (:require [\"@codemirror/language\" :refer [syntaxHighlighting HighlightStyle]]\r\n            [\"@codemirror/state\" :refer [EditorState]]\r\n            [\"@codemirror/view\" :refer [EditorView]]\r\n            [\"@lezer/highlight\" :refer [tags]]\r\n            [nextjournal.clojure-mode :as cm-clj]\r\n            [applied-science.js-interop :as j]))\r\n\r\n(def cm6-theme\r\n  (.theme EditorView\r\n          (j/lit {\"&.cm-focused\" {:outline \"none\"}\r\n                  \".cm-line\" {:padding \"0\"\r\n                              :line-height \"1.6\"\r\n                              :font-size \"15px\"\r\n                              :font-family \"\\\"Fira Mono\\\", monospace\"}\r\n                  \".cm-matchingBracket\" {:border-bottom \"1px solid var(--teal-color)\"\r\n                                         :color \"inherit\"}\r\n\r\n                  ;; only show cursor when focused\r\n                  \".cm-cursor\" {:visibility \"hidden\"}\r\n                  \"&.cm-focused .cm-cursor\" {:visibility \"visible\"\r\n                                             :animation \"steps(1) cm-blink 1.2s infinite\"}\r\n                  \"&.cm-focused .cm-selectionBackground\" {:background-color \"Highlight\"}\r\n                  \".cm-tooltip\" {:border \"1px solid rgba(0,0,0,.1)\"\r\n                                 :border-radius \"3px\"\r\n                                 :overflow \"hidden\"}\r\n                  \".cm-tooltip > ul > li\" {:padding \"3px 10px 3px 0 !important\"}\r\n                  \".cm-tooltip > ul > li:first-child\" {:border-top-left-radius \"3px\"\r\n                                                       :border-top-right-radius \"3px\"}})))\r\n\r\n(def highlight-style\r\n  (.define HighlightStyle\r\n    (clj->js [{:tag (.-meta tags) :class \"cmt-meta\"}\r\n              {:tag (.-link tags) :class \"cmt-link\"}\r\n              {:tag (.-heading tags) :class \"cmt-heading\"}\r\n              {:tag (.-emphasis tags) :class \"cmt-italic\"}\r\n              {:tag (.-strong tags) :class \"cmt-strong\"}\r\n              {:tag (.-strikethrough tags) :class \"cmt-strikethrough\"}\r\n              {:tag (.-keyword tags) :class \"cmt-keyword\"}\r\n              {:tag (.-atom tags) :class \"cmt-atom\"}\r\n              {:tag (.-bool tags) :class \"cmt-bool\"}\r\n              {:tag (.-url tags) :class \"cmt-url\"}\r\n              {:tag (.-contentSeparator tags) :class \"cmt-contentSeparator\"}\r\n              {:tag (.-labelName tags) :class \"cmt-labelName\"}\r\n              {:tag (.-literal tags) :class \"cmt-literal\"}\r\n              {:tag (.-inserted tags) :class \"cmt-inserted\"}\r\n              {:tag (.-string tags) :class \"cmt-string\"}\r\n              {:tag (.-deleted tags) :class \"cmt-deleted\"}\r\n              {:tag (.-regexp tags) :class \"cmt-regexp\"}\r\n              {:tag (.-escape tags) :class \"cmt-escape\"}\r\n              {:tag (.. tags (special (.-string tags))) :class \"cmt-string\"}\r\n              {:tag (.. tags (definition (.-variableName tags))) :class \"cmt-variableName\"}\r\n              {:tag (.. tags (local (.-variableName tags))) :class \"cmt-variableName\"}\r\n              {:tag (.-typeName tags) :class \"cmt-typeName\"}\r\n              {:tag (.-namespace tags) :class \"cmt-namespace\"}\r\n              {:tag (.-className tags) :class \"cmt-className\"}\r\n              {:tag (.. tags (special (.-variableName tags))) :class \"cmt-variableName\"}\r\n              {:tag (.-macroName tags) :class \"cmt-macroName\"}\r\n              {:tag (.. tags (definition (.-propertyName tags))) :class \"cmt-propertyName\"}\r\n              {:tag (.-comment tags) :class \"cmt-comment\"}\r\n              {:tag (.-invalid tags) :class \"cmt-invalid\"}])))\r\n\r\n(def ext #js [cm-clj/default-extensions\r\n              (syntaxHighlighting highlight-style)\r\n              (.. EditorView -editable (of false))\r\n              cm6-theme])\r\n\r\n(defn viewer* [value]\r\n  ^{:key value}\r\n  [:div {:ref #(when %\r\n                 (let [prev-view (j/get % :editorView)]\r\n                   (when (or (nil? prev-view)\r\n                             (not= value (j/call-in prev-view [:state :doc :toString])))\r\n                     (some-> prev-view (j/call :destroy))\r\n                     (j/assoc! % :editorView\r\n                               (EditorView. #js {:state (.create EditorState #js {:doc value :extensions ext})\r\n                                                 :parent %})))))}])\r\n\r\n(defn viewer [value]\r\n  ^{:nextjournal/viewer :reagent} [viewer* value])\r\n"]}
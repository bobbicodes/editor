{"version":3,"sources":["nextjournal/devcards.cljs"],"mappings":"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","names":["js/nextjournal","js/nextjournal.devcards","js/nextjournal.devcards.registry","nextjournal.devcards/registry","reagent.core.atom","flatland.ordered.map.ordered_map","p__60200","map__60201","cljs.core/--destructure-map","cljs.core.get","nextjournal.devcards/register-devcard*","opts","ns","name","cljs.core.swap_BANG_","cljs.core/assoc-in","nextjournal.devcards/error-boundary","_elem","error","reagent.core.create_class","_this","_","cljs.core/deref","cljs.core/reset!","e","info","trace","G__60203","clojure.string.split","cljs.core.map","clojure.string/trim","cljs.core.remove","cljs.core/empty?","clojure.string.join","elem","temp__5751__auto__","vec__60204","cljs.core.nth","temp__5753__auto__","stack","cljs.core.merge","nextjournal.view/wrap-render","p__60207","map__60208","nextjournal.view/wrap-methods","nextjournal.devcards/testview","state","cljs.core/update","cljs.core.fnil","cljs.core/inc","cljs.core.assoc","re_frame.context.reg_sub","db","re_frame.context.reg_event_db","cljs.core.update","p__60209","map__60210","re-frame.context/frame-context","nextjournal.devcards/testc","dispatch","subscribe","G__60211","G__60212","p__60213","map__60214","nextjournal.devcards/frame-display","re-frame.context/current-frame","cljs.core.into","frame","re_frame.frame.make_frame","re-frame.context/provide-frame","*current-frame*-orig-val__60215","re-frame.registry/*current-frame*","*current-frame*-temp-val__60216","cljs.core/PROTOCOL_SENTINEL","cljs.core/native-satisfies?","re-frame.frame/IFrame","js/Error","cljs.core.range"],"sourcesContent":["(ns nextjournal.devcards\r\n  (:require-macros [nextjournal.devcards :as dc])\r\n  (:require [clojure.string]\r\n            [flatland.ordered.map :as ordered-map]\r\n            [nextjournal.view :as v]\r\n            [re-frame.context :as rf]\r\n            [re-frame.frame :as rf.frame]\r\n            [reagent.core :as r]))\r\n\r\n(defonce registry (r/atom (ordered-map/ordered-map)))\r\n\r\n(defn register-devcard* [{:as opts :keys [ns name]}]\r\n  (swap! registry assoc-in [ns name] opts))\r\n\r\n(defn error-boundary [_elem]\r\n  (let [error (r/atom nil)]\r\n    (r/create-class\r\n     {:UNSAFE_component-will-receive-props\r\n      (fn [_this _]\r\n        (when @error\r\n          (reset! error nil)))\r\n      :component-did-catch\r\n      (fn [_this e ^js info]\r\n        (reset! error [e info])\r\n        (let [trace (some-> info\r\n                            (.-componentStack)\r\n                            (clojure.string/split \"\\n\")\r\n                            (->> (map clojure.string/trim)\r\n                                 (remove empty?)\r\n                                 (clojure.string/join \"\\n\")))]\r\n          (set! (.-componentStack info) trace)))\r\n      :reagent-render\r\n      (fn [elem]\r\n        (if-let [[e info] @error]\r\n          [:div.sans-serif\r\n           [:div.b.f6.red \"Error\"]\r\n           [:pre.text-xs.red.mt2.b\r\n            {:style {:overflow-x \"auto\"}}\r\n            (.-message e)]\r\n           (when-let [stack (.-componentStack ^js info)]\r\n             [:pre.text-xs.red.mt2\r\n              {:style {:overflow-x \"auto\"}}\r\n              stack])]\r\n          (do\r\n            (reset! error nil)\r\n            elem)))})))\r\n\r\n(v/defview testview [{::v/keys [state]}]\r\n  [:h1 {:on-click #(swap! state update :clicks (fnil inc 0))}\r\n   \"Hello \" (:name @state) \"! (\" (:clicks @state 0) \" clicks)\"])\r\n\r\n(dc/defcard testview-card\r\n  \"evaluating this form should change the inital state if changed.\"\r\n  [state]\r\n  [testview {::v/initial-state state}]\r\n  {::dc/state {:name \"World\"}\r\n   :some-value-in-db 1})\r\n\r\n\r\n(rf/reg-sub\r\n ::counter\r\n (fn [db]\r\n   (::counter db 0)))\r\n\r\n(rf/reg-event-db\r\n ::inc\r\n (fn [db]\r\n   (update db ::counter inc)))\r\n\r\n(v/defview testc [{::rf/keys [dispatch subscribe]}]\r\n  [:h1 {:on-click #(dispatch [::inc])} \"Counter = \" @(subscribe [::counter])])\r\n\r\n(dc/defcard counter-db-1\r\n  \"cards can use completely isolated dbs and use subscriptions and event handlers.\"\r\n  []\r\n  [testc]\r\n  {::counter 10})\r\n\r\n(dc/defcard counter-db-2\r\n  \"notice how clicking here doesn't affect the card above.\"\r\n  []\r\n  [testc]\r\n  {::counter 999})\r\n\r\n(dc/when-enabled\r\n (v/defview frame-display\r\n   {::v/initial-state\r\n    (fn []\r\n      (:frame-id (rf/current-frame)))}\r\n   [{::v/keys [state]}]\r\n   [:div @state \"/\" (:frame-id (rf/current-frame))]))\r\n\r\n(dc/defcard multiframe\r\n \"Demonstrates using multiple isolated frames in a component\"\r\n  []\r\n  (into [:div]\r\n        (map\r\n         #(let [frame (rf.frame/make-frame\r\n                       {:registry (:registry (rf/current-frame))\r\n                        :app-db (r/atom {})})]\r\n            [rf/provide-frame frame\r\n             (rf/bind-frame frame\r\n                            [frame-display])])\r\n         (range 2))))\r\n\r\n(dc/defcard device-frame\r\n  \"Renders inside an iframe with a device frame, currently limited to :iphone\"\r\n  []\r\n  [:div.font-sans\r\n   [:div.p-8.text-2xl.fixed.left-0.top-0.right-0.bg-red-500 \"Fixed on top\"]\r\n   [:div.p-8.text-2xl.fixed.left-0.right-0.bg-blue-500\r\n    {:class \"bottom-[78px]\"}\r\n    \"Fixed on bottom\"]]\r\n  {::dc/device :iphone})"]}